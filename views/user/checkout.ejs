<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <link href="https://fonts.googleapis.com/css?family=Cinzel:400,700|Montserrat:400,700|Roboto&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900|RobotoDraft:400,100,300,500,700,900">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">



    <link rel="stylesheet" href="/fonts/icomoon/style.css">
    <link rel="stylesheet" href="/fonts/ionicons/style.css">
    <link rel="stylesheet" href="/fonts/open-ionic/style.css">
    <link rel="stylesheet" href="/css/animate.css">



    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-datepicker.min.css">

    <link rel="stylesheet" href="/css/jquery-ui.css">
    <link rel="stylesheet" href="/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css">


    <link rel="stylesheet" href="/stylesheets/bootstrap-datepicker.css">
    <link rel="stylesheet" href="/stylesheets/jquery.timepicker.css">


    <link rel="stylesheet" href="/fonts/flaticon/font/flaticon.css">

    <link rel="stylesheet" href="/css/aos.css">
    <link href="/css/jquery.mb.YTPlayer.min.css" media="all" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/magnific-popup.css">



    <link rel="stylesheet" href="/css/style2.css">
    <link rel="stylesheet" href="/css/style.css">




    <link
            href='https://fonts.googleapis.com/css?family=Actor|Berkshire+Swash|Great+Vibes|Josefin+Sans|Lato:300|Lobster Two|&subset=latin,latin-ext'
            rel='stylesheet' type='text/css'>

</head>


<body data-spy="scroll" data-target=".site-navbar-target" data-offset="300">
<div class="site-wrap">
    <div class="site-mobile-menu site-navbar-target">
        <div class="site-mobile-menu-header">
            <div class="site-mobile-menu-close mt-3">
                <span class="icon-close2 js-menu-toggle"></span>
            </div>
        </div>
        <div class="site-mobile-menu-body"></div>
    </div>

 


 
<div class="header-top">
  <div class="container">
      <div class="row align-items-center">
          <div class="col-12 text-center">
              <a href="/" class="site-logo">
                <img src="/img/logos/foodpanda-c.png " width="500" height="80" >
                  <!-- <img src="/images/logo.png" alt="Image" class="img-fluid"> -->
              </a>
          </div>
          <a href="#" class="mx-auto d-inline-block d-lg-none site-menu-toggle js-menu-toggle text-black"><span
                  class="icon-menu h3"></span></a>
      </div>
  </div>




  <div class="site-navbar py-2 js-sticky-header site-navbar-target d-none pl-0 d-lg-block" role="banner">

      <div class="container">
          <div class="d-flex align-items-center">

              <div class="mx-auto">
                  <nav class="site-navigation position-relative text-left" role="navigation">
                      <ul class="site-menu main-menu js-clone-nav mx-auto d-none pl-0 d-lg-block border-none">
                          <li class="active"><a href="/user/home" class="nav-link text-left">Home</a></li>
                          <li><a href="/shop/about" class="nav-link text-left">About</a></li>
                          <li class="nav-item dropdown">
                              <a class="nav-link dropdown-toggle" href="#" id="dropdown04" data-toggle="dropdown"
                                 aria-haspopup="true" aria-expanded="false">ACOUNT</a>
                              <div class="dropdown-menu" aria-labelledby="dropdown04">
                                  
                                      <a class="dropdown-item" href="/user/profile">Profile</a>
                                      <a class="dropdown-item" href="/user/logout">Logout</a>
                                  
                                      <!-- <a class="dropdown-item" href="/user/signup">Signup</a>
                                      <a class="dropdown-item" href="/user/signin">Signin</a> -->
                                  
                              </div>
                          </li>
                          <li class="nav-item dropdown">
                              <a class="nav-link dropdown-toggle" href="#" id="dropdown04" data-toggle="dropdown"
                                 aria-haspopup="true" aria-expanded="false">Shop</a>
                              <div class="dropdown-menu" aria-labelledby="dropdown04">
                                  <a class="dropdown-item" href="">Menu</a>
                                  <a class="dropdown-item" href="/user/cart">Cart</a>
                                  <a class="dropdown-item" href="/user/checkout">Checkout</a>
                              </div>
                          </li>
                         
                          <li class="nav-item cta cta-colored"><a href="http://localhost:3000/user/cart" class="nav-link"><span
                                  class="icon-shopping_cart"> </span></a></li>

                      </ul>
                  </nav>

              </div>

          </div>
      </div>

  </div>

</div>



<section>
    <div class="container py-5">
      <form id="checkout">
        <div class="row d-flex justify-content-center align-items-center h-15">
          <div class="col-12">
            <div class="card card-registration-2" style="border-radius: 15px">
              <div class="card-body p-0">
                <div class="row g-0 ">
                  <div class="col-lg-8">
                    <div class="p-5 border">
                      <div class="d-flex justify-content-between align-items-center mb-5 ">
                        <h1 class="fw-bold mb-0" style="color: rgb(3, 3, 58);">Order Details</h1>
                      </div>
                      <table id="tableForm" class="table sm-2">
                        <thead>
                          <tr>

                            <th scope="col">Product</th>
                            <th scope="col">Quatity</th>
                            <th scope="col">Price</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% allData.forEach(element=> { %>
                            <tr>
                              <td>
                                <%= element.productDetail.item_name %>
                              </td>
                              <td>
                                <%= element.productQuantity %>
                              </td>
                    
                              <td>
                                Rs. <%= element.productDetail.price %>
                              </td>
                            </tr>
                            <% }) %>
                        </tbody>
                      </table>
                      <p>Shipping charge: Rs.100.00</p>
                      <p>Tax: Rs.<%= Math.round(sum*.15) %>.00 </p>
                      <b>Total: Rs.<%= Math.round(sum*.15) + sum + 100 %> </b>

                      <div class="payment col-md-6 mt-3 d-flex justify-content-center ms-5 px-5">
                        <h5 class="text-black">Payment:</h5>
                        <div class="p-1 col-md-8   text-dark">
                          <input type="radio" name="pay" value="cod" class="me-1" required checked />
                          Cash On Delivery
                        </div>
                        <div class="p-1 col-sm-8  text-dark">
                          <input type="radio" name="pay" value="online" class="me-1"
                            style="background-color: rgb(127, 127, 131); " required />
                          Pay Online
                        </div>
                      </div>




                    </div>
                  </div>
                  <div class="col-sm-4 text-light border border-secondary"
                    style="background-color: rgb(88, 88, 91);">
                    <div class="p-5">

                      <div class="shipadrss col-md-12 mt-3">
                        <h5 class="text-light">Shipping Address:</h5>

                        <% address.forEach(data=> { %>
                          <div style="border: 1px solid"
                            class="p-4 d-flex align-content-center align-items-center d9">
                            <input type="radio" value="<%= data._id %>" name="address" required checked />
                            <p class="ms-3">
                              <b>
                                <%= name %>
                              </b><br />
                              <%= data.address %> <br>
                                <%= data.state %>,
                                  <%= data.city %> <br>
                                    <%= data.pincode %>
                            </p>
                          </div>
                          <% }) %>

                            <div class="mt-3 d-flex align-items-center d9">
                              <a href="/user/addAddress" class="btn btn-light">+ Add New Address</a>
                            </div>

                      </div>



                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>

          <div class="payment col-md-2 mt-3 p-1">
            <button type="submit" class="btn btn-primary btn-lg w-100 mt-2">
              Confirm Order
            </button>
            <a href="/user/cart" class="btn btn-primary btn-lg w-100 mt-2">
              Go Back
            </a>
          </div>
      </form>

    </div>

  </section>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

          <script >
            function changeQuantity(cartId, productId, count) {
  $.ajax({
    url: '/user/cartQuantity',
    data: {
      cart: cartId,
      product: productId,
      count,
    },
    method: 'post',
    success: (res) => {
      // document.getElementById('quantity').innerText = Number(qty) + Number(count);
      location.reload();
      // $('#quantity').load(`${document.URL} #quantity`);
    },
  });
}

function deleteProduct(cartId, productId) {
  $.ajax({
    url: '/user/deleteProduct',
    data: {
      cart: cartId,
      product: productId,
    },
    method: 'post',
    success: () => {
      Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!',
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire(
            'Deleted!',
            'Your file has been deleted.',
            'success',
          );
        }
      }).then(() => {
        location.reload();
      });
    },
  });
}


          </script>

          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

          <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
          <script>
            $("#checkout").submit((e) => {
              e.preventDefault();
              Swal.fire({
                title: 'Confirm?',
                text: "Click confirm to proceed with your order",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Confirm'
              }).then((result) => {
                if (result.isConfirmed) {
                  Swal.fire({
                    icon: 'success',
                    title: 'Order Confirmed',                
                  }).then(() => {
                    $.ajax({
                      url: "/user/orderConfirmed",
                      method: "post",
                      data: $("#checkout").serialize(),
                      success: (response) => {
                        console.log(response);
                        if (response[0].success) {
                          location.href = `/user/orderSuccess`;
                        } else {
                          razorPay(response[0].orders);
                          console.log(response[0].orders)
                        }
                      },
                    });
                  })
                }
              })
            });
            // function razorPay(order) {
            //   var options = {
            //     key: "rzp_test_Qz0gX7o4vKhyTg", // Enter the Key ID generated from the Dashboard
            //     amount: order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
            //     currency: "INR",
            //     name: "ComicMerchs",
            //     description: "Test Transaction",
            //     order_id: order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
            //     handler: function (response) {
            //       console.log(response);
            //       verifyPayment(response, order);
            //     },
            //     prefill: {
            //       name: "abin",
            //       email: "abin@gmail.com",
            //       contact: "8089000000",
            //     },
            //     notes: {
            //       address: "Razorpay Corporate Office",
            //     },
            //     theme: {
            //       color: "#3399cc",
            //     },
            //   };
            //   var rzp1 = new Razorpay(options);
            //   console.log('options are  jksdfskjdsdfjsl', options);
            //   rzp1.on("payment.failed", function (response) {
            //   });
            //   rzp1.open();
            // }
            // function verifyPayment(payment, order) {
            //   console.log('order is', order);
            //   $.ajax({
            //     url: "/user/verifyPayment",
            //     data: {
            //       payment,
            //       order,
            //     },
            //     method: "post",
            //     success: (response) => {
            //       if (response.success) {
            //         location.href = '/user/orderSuccess';
            //         // location.href = '/user/orderSuccess';
            //         console.log('payment success');
            //       } else {
            //         location.href = "/user/paymentFail";
            //         console.log('payment failed');
            //       }
            //     },
            //   });
            // }
          </script>






<%- include('../partials/userFooter.ejs') %>